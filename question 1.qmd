---
title: "Question1"
author: "Puwen Wen"
format: html
editor: visual
---

## Model Set Up

### Package loading

```{r}
library(plm)
```

### income_ratio model with lags

```{r}

panelA$income_ratio <- (panelA$Mean_income_FOR/panelA$Mean_income_NAT)*100
panelA$Immigration_percentage <- panelA$Imigration_ratio*100


panelA_reg <- panelA |> group_by(geo,c_birth)|>
  mutate(income_ratio_lag1 = dplyr::lag(income_ratio,n = 1))|>
  mutate(Immigration_percentage_lag1 = dplyr::lag(Immigration_percentage,n = 1))|>
  mutate(income_ratio_lag2 = dplyr::lag(income_ratio, n = 2))|>
  mutate(Immigration_percentage_lag2 = dplyr::lag(Immigration_percentage,n = 2))|>
  ungroup()



model_with_lags <- plm(income_ratio ~ Immigration_percentage+Immigration_percentage_lag1+Immigration_percentage_lag2+income_ratio_lag1+income_ratio_lag2,data = panelA_reg, index = c("geo", "TIME_PERIOD"), model = "random")
summary(model_with_lags)
```

### test

```{r}
# Example panel data
data <- data.frame(
ID = c(1, 1, 1, 2, 2, 2),
TIME_PERIOD = c(1, 2, 3, 1, 2, 3),
VAR1 = c(10, 20, 30, 40, 50, 60),
VAR2 = c(5, 15, 25, 35, 45, 55)
 )
 
 # Compute lagged terms for VAR1 and VAR2
data_with_lags <- data %>%
  arrange(ID, TIME_PERIOD) %>% # First arrange the data by ID and TIME_PERIOD
  group_by(ID) %>% # Group by panel ID
  mutate(
    LAG_VAR1 = lag(VAR1, n = 1), # Lagged term of VAR1
    LAG_VAR2 = lag(VAR2, n = 1)  # Lagged term of VAR2
    ) %>%
  ungroup() # Ungroup after computation
print(data_with_lags)

```

### model with interaction terms
```{r}
panelA_reg <- panelA_reg |>
  mutate(
    income_ratio_lag1_Immigration_percentage_lag1 = income_ratio_lag1 * Immigration_percentage_lag1,
    income_ratio_lag1_Immigration_percentage_lag2 = income_ratio_lag1 * Immigration_percentage_lag2,
    income_ratio_lag2_Immigration_percentage_lag1 = income_ratio_lag2 * Immigration_percentage_lag1,
    income_ratio_lag1_income_ratio_lag2 = income_ratio_lag1 * income_ratio_lag2,
    Immigration_percentage_lag1_Immigration_percentage_lag2 = Immigration_percentage_lag1 * Immigration_percentage_lag2
  )

model_with_interactions <- plm(
  income_ratio ~ Immigration_percentage +
                 Immigration_percentage_lag1 +
                 Immigration_percentage_lag2 +
                 income_ratio_lag1 +
                 income_ratio_lag2 +
                 income_ratio_lag1_Immigration_percentage_lag1 +
                 income_ratio_lag1_Immigration_percentage_lag2 +
                 income_ratio_lag2_Immigration_percentage_lag1 +
                 income_ratio_lag1_income_ratio_lag2 +
                 Immigration_percentage_lag1_Immigration_percentage_lag2,
  data = panelA_reg,
  index = c("geo", "TIME_PERIOD"),
  model = "random"
)

summary(model_with_interactions)



```

### DID on Syrian Refuge Crisis

We choose Syrian 
